From 0ebd85fb55c73524553d09fcb639f19ac349d8fd Mon Sep 17 00:00:00 2001
From: Andreas Stefl <stefl.andreas@gmail.com>
Date: Sat, 3 May 2025 14:36:21 +0200
Subject: [PATCH 1/2] makefile no march

---
 Makefile | 6 +++---
 1 file changed, 3 insertions(+), 3 deletions(-)

diff --git a/Makefile b/Makefile
index 44c076a..cb991bb 100644
--- a/Makefile
+++ b/Makefile
@@ -15,7 +15,7 @@
 # software. If not, they may be obtained at the above URLs.
 #
 
-RUN = argon2
+RUN = argon2$(RUN_EXT)
 BENCH = bench
 GENKAT = genkat
 ARGON2_VERSION ?= ZERO
@@ -49,7 +49,7 @@ CI_CFLAGS := $(CFLAGS) -Werror=declaration-after-statement -D_FORTIFY_SOURCE=2 \
 				-Wextra -Wno-type-limits -Werror -coverage -DTEST_LARGE_RAM
 
 OPTTARGET ?= native
-OPTTEST := $(shell $(CC) -Iinclude -Isrc -march=$(OPTTARGET) src/opt.c -c \
+OPTTEST := $(shell $(CC) $(CFLAGS) -Iinclude -Isrc src/opt.c -c \
 			-o /dev/null 2>/dev/null; echo $$?)
 # Detect compatible platform
 ifneq ($(OPTTEST), 0)
@@ -57,7 +57,7 @@ $(info Building without optimizations)
 	SRC += src/ref.c
 else
 $(info Building with optimizations for $(OPTTARGET))
-	CFLAGS += -march=$(OPTTARGET)
+	#CFLAGS += -march=$(OPTTARGET)
 	SRC += src/opt.c
 endif
 
-- 
2.39.5 (Apple Git-154)

